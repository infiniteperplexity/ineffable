<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
</head>
<body>
<style>
</style>
<script src="http://d3js.org/d3.v3.js"></script>
<script>
var csv_data = [];
for(var i = 0; i<10; i++) {
	csv_data.push({row: "row" + i});
	for (var j = 0; j<10; j++) {
		csv_data[i]["variable" + j] = Math.random();
	}
}

var svg = d3.select("body")
  .append("svg")
  	.attr("width",1000)
  	.attr("height",1000)
;

var nQuants = 4;
var cellHeight = 25;
var cellWidth = 25;
var nRows;
var nCols;
var columns;
var rows;
function callback(data) {
	//csv_data = data;
	columns = d3.map(csv_data[0]).keys();
	columns.shift();
	rows = csv_data.map(function(row) {return row["row"];})
	var x = d3.scale.ordinal()
		.domain(columns)
		.range(d3.range(columns.length))
	;
	var y = d3.scale.ordinal()
		.domain(rows)
		.range(rows.length)
	;
	var flattened = [];
	for(var i = 0; i<rows.length; i++) {
		for(var j = 0; j<columns.length; j++) {
			flattened.push(csv_data[i][columns[j]]);
		}
	}
	
	var quantiles = [];
	for(var i = 0; i<=nQuants; i++) {
		quantiles.push(d3.quantile(flattened,i/nQuants));
	}
	var color = d3.scale.linear()
		.domain(quantiles)
		.range(["white","red"])
	;
	
	//should I check whether the two axes are the same to do a half graph?
	//var xAxis = d3.svg.axis()
	//	.scale(x)
	//;
	//var yAxis = d3.svg.axis()
	//	.scale(y)
	//;
	//svg.append("g")
	//	.call(xAxis)
	//;
	//svg.append("g")
	//	.call(yAxis)
	//;
	svg.selectAll("g")
		.data(csv_data).enter()
	  .append("g")
		.attr("transform",function(d,i) {return "translate(0," + i*cellHeight + ")";})
	  .selectAll("rect")
		.data(function(row) {columns.map(function(i) {return row[columns[i]];})}).enter()
	 // .append("rect")
	  //	.attr("x",function(d,i) {return i*cellWidth;})
	  	//.style("fill",function(d) {return color(i);})
	;
	
}

callback(csv_data);
</script>
</body>
</html>